# üõ°Ô∏è Cap-Ark

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
![Mobile Friendly](https://img.shields.io/badge/Mobile-Friendly-brightgreen)

**Cap-Ark** is a lightweight, mobile-friendly path-tracing CAPTCHA.  
Instead of selecting images, users trace a generated path. Human-like motion,
timing, and path coverage are analyzed to determine validity.

Designed for:
- Mobile and desktop
- iframe embedding
- One-time verification tokens
- Self-hosting or hosted usage

---

## Table of Contents

- [How It Works](#how-it-works)
- [Quick Start (Embed)](#-quick-start-embed)
  - [1. HTML](#1-html)
  - [2. JavaScript](#2-javascript)
- [API Reference](#-api-reference)
  - [/challenge](#challenge)
  - [/verify](#verify)
  - [/validate-token](#validate-token)
- [Verification Logic](#verification-logic)
- [Token Lifecycle](#token-lifecycle)
- [Customization](#customization)
- [License](#-license)

---

## How It Works

1. A challenge path is generated by the server.
2. The user traces the path using touch or mouse input.
3. Motion data (position + time) is analyzed server-side.
4. If the trace meets the verification criteria:
   - A signed, one-time token is issued.
5. The parent page validates the token to confirm a successful human check.

---

## üöÄ Quick Start (Embed)

### 1. HTML

Place this iframe where you want the CAPTCHA to appear:

```html
<iframe
  id="capark-captcha"
  src="https://cap-ark.duckdns.org/gen"
  style="width: 100%; height: 300px; border: 2px solid #eaecef; border-radius: 12px;"
  frameborder="0">
</iframe>

2. JavaScript

Add this script to the parent page.
It listens for the verification token and validates it.

window.addEventListener("message", async (e) => {
  if (!e.data || !e.data.capark_token) return;

  const response = await fetch("https://cap-ark.duckdns.org/validate-token", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ token: e.data.capark_token })
  });

  const result = await response.json();

  if (result.valid) {
    console.log("‚úÖ Human verified");
  } else {
    console.log("‚ùå Verification failed");
  }
});

üõ†Ô∏è API Reference
/challenge

Method: GET
Description: Generates a new tracing challenge.

Response:

{
  "challenge_id": "string",
  "path": [
    { "x": 40, "y": 100 },
    { "x": 90, "y": 120 }
  ]
}

/verify

Method: POST
Description: Submits trace data for scoring.

Request Body:

{
  "challenge_id": "string",
  "points": [
    { "x": 120.5, "y": 98.2, "t": 1532.4 },
    { "x": 121.8, "y": 99.1, "t": 1548.7 }
  ]
}

Response (success):

{
  "success": true,
  "token": "string",
  "score": 0.82
}

Response (failure):

{
  "success": false,
  "score": 0.31
}

/validate-token

Method: POST
Description: Confirms whether a token is valid.

Request Body:

{
  "token": "string"
}

Response:

{
  "valid": true
}

Verification Logic

A trace is considered valid when it satisfies all of the following:

    Sufficient number of recorded points

    Total trace duration within expected bounds

    Close proximity to the generated path

    Adequate coverage of the full path

    Natural speed variation across the trace

    Final score meets the acceptance threshold

Each verification returns a normalized score between 0.0 and 1.0.
Token Lifecycle

    Tokens are issued only after successful verification

    Each token:

        Is valid for a limited time

        Can be validated once

    After validation, the token is permanently removed

This ensures tokens cannot be reused.
Customization

When self-hosting, the following parameters can be tuned:

    Minimum points required

    Allowed trace duration

    Path tolerance radius

    Coverage and accuracy thresholds

    Scoring strictness

These values allow Cap-Ark to be adapted for different user bases and devices.
üìú License

MIT License
You are free to use, modify, and self-host Cap-Ark.

If using the hosted instance (cap-ark.duckdns.org), please follow fair-use practices.
